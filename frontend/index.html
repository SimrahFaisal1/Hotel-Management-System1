<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StayEase - Hotel Booking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        /* Navbar */
        .navbar {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .nav-links button:hover {
            background: rgba(255,255,255,0.1);
        }

        .btn-primary {
            background: #2563eb !important;
            padding: 0.6rem 1.5rem !important;
        }

        .btn-primary:hover {
            background: #1d4ed8 !important;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #1e3a8a 100%);
            padding: 5rem 2rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M0,0 Q300,40 600,20 T1200,0 L1200,120 L0,120 Z" fill="rgba(255,255,255,0.05)"/></svg>') repeat-x bottom;
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            opacity: 0.95;
        }

        /* Search Bar */
        .search-container {
            max-width: 1100px;
            margin: -4rem auto 3rem;
            padding: 0 1rem;
            position: relative;
            z-index: 10;
        }

        .search-box {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
            font-size: 0.95rem;
        }

        .input-group input,
        .input-group select {
            padding: 0.9rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn-search {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }

        /* Content Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hotel Cards */
        .hotels-grid {
            display: grid;
            gap: 2rem;
        }

        .hotel-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
            display: grid;
            grid-template-columns: 320px 1fr;
        }

        .hotel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .hotel-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }

        .hotel-info {
            padding: 2rem;
            display: flex;
            flex-direction: column;
        }

        .hotel-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .hotel-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .rating {
            background: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .hotel-address {
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .hotel-description {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            flex-grow: 1;
        }

        .amenities {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        .amenity-tag {
            background: #f3f4f6;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #374151;
        }

        .hotel-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1.5rem;
            border-top: 2px solid #f3f4f6;
        }

        .price {
            display: flex;
            flex-direction: column;
        }

        .price-label {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .price-amount {
            font-size: 2rem;
            font-weight: 700;
            color: #2563eb;
        }

        .btn-view {
            background: #2563eb;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-view:hover {
            background: #1d4ed8;
            transform: scale(1.05);
        }

        /* Hotel Details */
        .details-container {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .details-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }

        .details-content {
            padding: 3rem;
        }

        .rooms-section {
            margin-top: 3rem;
        }

        .room-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        .room-card:hover {
            border-color: #2563eb;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.1);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .room-type {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .room-details {
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .availability {
            color: #059669;
            font-weight: 600;
            margin-left: 1rem;
        }

        .btn-book {
            background: #2563eb;
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-book:hover {
            background: #1d4ed8;
        }

        .btn-book:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        /* Login Form */
        .login-container {
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .login-box {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
            color: #1f2937;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .btn-login {
            width: 100%;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
        }

        /* Admin Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #6b7280;
            font-weight: 600;
        }

        table {
            width: 100%;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        th {
            background: #f9fafb;
            padding: 1.5rem;
            text-align: left;
            font-weight: 700;
            color: #374151;
        }

        td {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-confirmed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #2563eb;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .back-button:hover {
            color: #1d4ed8;
            transform: translateX(-5px);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: #1f2937;
        }

        .hidden {
            display: none !important;
        }

        /* Features Section */
        .features {
            padding: 4rem 2rem;
        }

        .features-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 3rem;
            color: #1f2937;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .feature-desc {
            color: #6b7280;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1.2rem;
            }

            .search-grid {
                grid-template-columns: 1fr;
            }

            .hotel-card {
                grid-template-columns: 1fr;
            }

            .hotel-image {
                height: 200px;
            }

            .nav-links {
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo" onclick="showPage('home')">
                <span>üè®</span>
                <span>StayEase</span>
            </div>
            <div class="nav-links">
                <button onclick="showPage('home')">Home</button>
                <button id="bookingsNavBtn" class="hidden" onclick="showPage('bookings')">My Bookings</button>
                <button id="adminNavBtn" class="hidden" onclick="showPage('admin')">Dashboard</button>
                <span id="userGreeting" class="hidden"></span>
                <button id="loginBtn" onclick="showPage('login')" class="btn-primary">Login</button>
                <button id="logoutBtn" class="hidden btn-primary" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Home Page -->
    <div id="homePage">
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>Find Your Perfect Stay</h1>
                <p>Search from thousands of hotels worldwide</p>
            </div>
        </section>

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-box">
                <div class="search-grid">
                    <div class="input-group">
                        <label>üìç City / Destination</label>
                        <input type="text" id="cityInput" list="cities" placeholder="Where are you going?">
                        <datalist id="cities">
                            <option value="Karachi">
                            <option value="Lahore">
                            <option value="Islamabad">
                            <option value="Dubai">
                            <option value="Istanbul">
                            <option value="London">
                        </datalist>
                    </div>
                    <div class="input-group">
                        <label>üìÖ Check-in</label>
                        <input type="date" id="checkInInput">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Check-out</label>
                        <input type="date" id="checkOutInput">
                    </div>
                    <div class="input-group">
                        <label>üë• Guests</label>
                        <input type="number" id="guestsInput" min="1" value="1">
                    </div>
                </div>
                <button class="btn-search" onclick="searchHotels()">üîç Search Hotels</button>
            </div>
        </div>

        <!-- Features Section -->
        <section class="features">
            <h2 class="features-title">Why Choose StayEase?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3 class="feature-title">Easy Search</h3>
                    <p class="feature-desc">Find hotels quickly with our advanced search and filters</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üí∞</div>
                    <h3 class="feature-title">Best Prices</h3>
                    <p class="feature-desc">Guaranteed lowest prices on all bookings</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚≠ê</div>
                    <h3 class="feature-title">Quality Stays</h3>
                    <p class="feature-desc">Verified hotels with genuine reviews</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Search Results Page -->
    <div id="resultsPage" class="hidden">
        <div class="container">
            <div class="back-button" onclick="showPage('home')">
                ‚Üê Back to search
            </div>
            <h1 class="page-title">Available Hotels</h1>
            <div id="resultsContainer" class="hotels-grid"></div>
        </div>
    </div>

    <!-- Hotel Details Page -->
    <div id="detailsPage" class="hidden">
        <div class="container">
            <div class="back-button" onclick="showPage('results')">
                ‚Üê Back to results
            </div>
            <div id="detailsContainer"></div>
        </div>
    </div>

    <!-- Role Selection Page -->
    <div id="roleSelectionPage" class="hidden">
        <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); padding: 2rem;">
            <div style="text-align: center; color: white; max-width: 600px;">
                <div style="font-size: 4rem; margin-bottom: 2rem;">üè®</div>
                <h1 style="font-size: 3rem; font-weight: 700; margin-bottom: 1rem;">StayEase</h1>
                <p style="font-size: 1.3rem; margin-bottom: 3rem; opacity: 0.9;">Welcome to Your Premium Hotel Booking Platform</p>
                
                <div style="background: rgba(255,255,255,0.1); padding: 3rem; border-radius: 16px; backdrop-filter: blur(10px);">
                    <p style="font-size: 1.2rem; margin-bottom: 2rem; font-weight: 600;">How do you want to proceed?</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <button onclick="selectRole('user')" style="background: white; color: #1e3a8a; border: none; padding: 2rem 1.5rem; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                            <div style="font-size: 2.5rem; margin-bottom: 1rem;">üë§</div>
                            <div>Book a Hotel</div>
                            <div style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">Browse & book hotels</div>
                        </button>
                        
                        <button onclick="selectRole('admin')" style="background: white; color: #1e3a8a; border: none; padding: 2rem 1.5rem; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                            <div style="font-size: 2.5rem; margin-bottom: 1rem;">üîê</div>
                            <div>Admin Panel</div>
                            <div style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">Manage hotels & bookings</div>
                        </button>
                    </div>
                </div>
                
                <p style="margin-top: 2rem; font-size: 0.95rem; opacity: 0.8;">
                    Already have an account? <button onclick="goToLogin()" style="background: none; border: none; color: white; text-decoration: underline; cursor: pointer; font-size: 0.95rem;">Sign in here</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="hidden">
        <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); padding: 2rem;">
            <div style="background: white; border-radius: 16px; padding: 3rem; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 450px; width: 100%;">
                <button onclick="showPage('roleSelection')" style="background: none; border: none; color: #2563eb; cursor: pointer; font-size: 0.9rem; margin-bottom: 1.5rem;">‚Üê Back</button>
                
                <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; color: #1e3a8a;">üè® StayEase</h2>
                <p style="color: #6b7280; margin-bottom: 2rem;">Sign in to your account</p>
                
                <!-- Tabs -->
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #e5e7eb;">
                    <button id="loginTabBtn" onclick="switchAuthTab('login')" style="background: none; border: none; padding: 1rem 0; font-weight: 600; color: #2563eb; border-bottom: 3px solid #2563eb; cursor: pointer; flex: 1; text-align: left;">Sign In</button>
                    <button id="signupTabBtn" onclick="switchAuthTab('signup')" style="background: none; border: none; padding: 1rem 0; font-weight: 600; color: #6b7280; cursor: pointer; flex: 1; text-align: left;">Sign Up</button>
                </div>

                <!-- Login Form -->
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label style="font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block;">Email</label>
                        <input type="email" id="emailInput" placeholder="your@email.com" required style="width: 100%; padding: 0.9rem; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 1rem;">
                    </div>
                    <div class="form-group">
                        <label style="font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block;">Password</label>
                        <input type="password" id="passwordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required style="width: 100%; padding: 0.9rem; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 1rem;">
                    </div>
                    <button type="submit" class="btn-login" style="width: 100%; padding: 1rem; background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; border: none; border-radius: 10px; font-weight: 700; font-size: 1rem; cursor: pointer; margin-top: 1rem;">Sign In</button>
                </form>

                <!-- Signup Form (hidden by default) -->
                <form id="signupForm" onsubmit="handleSignup(event)" style="display: none;">
                    <div class="form-group">
                        <label style="font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block;">Full Name</label>
                        <input type="text" id="nameInput" placeholder="Your name" required style="width: 100%; padding: 0.9rem; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 1rem;">
                    </div>
                    <div class="form-group">
                        <label style="font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block;">Email</label>
                        <input type="email" id="signupEmailInput" placeholder="your@email.com" required style="width: 100%; padding: 0.9rem; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 1rem;">
                    </div>
                    <div class="form-group">
                        <label style="font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block;">Password</label>
                        <input type="password" id="signupPasswordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6" style="width: 100%; padding: 0.9rem; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 1rem;">
                    </div>
                    <button type="submit" class="btn-login" style="width: 100%; padding: 1rem; background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; border: none; border-radius: 10px; font-weight: 700; font-size: 1rem; cursor: pointer; margin-top: 1rem;">Create Account</button>
                </form>

                <p style="text-align: center; margin-top: 1.5rem; color: #6b7280; font-size: 0.9rem;">
                    Demo: ahmed@example.com / user123 (User) or admin@hotel.com / admin123 (Admin)
                </p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminPage" class="hidden">
        <div class="container">
            <h1 class="page-title">Admin Dashboard</h1>
            
            <div class="stats-grid" id="statsContainer">
                <div class="stat-card">
                    <div class="stat-value" id="totalHotels">0</div>
                    <div class="stat-label">üè® Total Hotels</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalBookings">0</div>
                    <div class="stat-label">üìä Total Bookings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">PKR 0</div>
                    <div class="stat-label">üí∞ Revenue</div>
                </div>
            </div>

            <div style="margin-top: 2rem; padding-bottom: 2rem; border-bottom: 2px solid #e5e7eb;">
                <h2 style="margin-bottom: 1.5rem; font-size: 1.8rem;">Hotels Management</h2>
                <button onclick="showAddHotelForm()" style="background: #2563eb; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">+ Add New Hotel</button>
                <div id="addHotelForm" style="display: none; margin-top: 1.5rem; padding: 2rem; background: #f9fafb; border-radius: 8px;">
                    <h3>Add New Hotel</h3>
                    <form onsubmit="handleAddHotel(event)" style="max-width: 600px;">
                        <div class="form-group">
                            <input type="text" id="hotelName" placeholder="Hotel Name" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="hotelCity" placeholder="City" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="hotelAddress" placeholder="Address" required>
                        </div>
                        <div class="form-group">
                            <textarea id="hotelDescription" placeholder="Description" required></textarea>
                        </div>
                        <div class="form-group">
                            <input type="number" id="hotelRating" placeholder="Rating (1-5)" step="0.1" required>
                        </div>
                        <button type="submit" class="btn-login">Create Hotel</button>
                        <button type="button" onclick="document.getElementById('addHotelForm').style.display='none'" style="background: #6b7280; color: white; border: none; padding: 0.8rem 1.5rem; margin-left: 1rem; border-radius: 8px; cursor: pointer;">Cancel</button>
                    </form>
                </div>
                <table style="width: 100%; margin-top: 1.5rem; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f3f4f6; border-bottom: 2px solid #e5e7eb;">
                            <th style="padding: 1rem; text-align: left;">Hotel Name</th>
                            <th style="padding: 1rem; text-align: left;">City</th>
                            <th style="padding: 1rem; text-align: left;">Rating</th>
                            <th style="padding: 1rem; text-align: center;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="hotelsTableBody">
                        <tr><td colspan="4" style="padding: 1rem; text-align: center;">Loading hotels...</td></tr>
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 2rem; padding-bottom: 2rem; border-bottom: 2px solid #e5e7eb;">
                <h2 style="margin-bottom: 1.5rem; font-size: 1.8rem;">All Bookings</h2>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f3f4f6; border-bottom: 2px solid #e5e7eb;">
                            <th style="padding: 1rem; text-align: left;">Hotel</th>
                            <th style="padding: 1rem; text-align: left;">Guest</th>
                            <th style="padding: 1rem; text-align: left;">Check-in</th>
                            <th style="padding: 1rem; text-align: left;">Amount</th>
                            <th style="padding: 1rem; text-align: left;">Status</th>
                            <th style="padding: 1rem; text-align: center;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsTableBody">
                        <tr><td colspan="6" style="padding: 1rem; text-align: center;">Loading bookings...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- My Bookings Page -->
    <div id="bookingsPage" class="hidden">
        <div class="container">
            <div class="back-button" onclick="showPage('home')">‚Üê Back to search</div>
            <h1 class="page-title">My Bookings</h1>
            <div id="bookingsContainer"></div>
        </div>
    </div>

    <!-- AI Chat Widget -->
    <div id="chatWidget" style="position: fixed; bottom: 2rem; right: 2rem; z-index: 999; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
        <!-- Chat Bubble Button -->
        <button id="chatToggle" onclick="toggleChat()" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); color: white; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(30, 58, 138, 0.4); font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s; hover-scale: 1.1;">
            üí¨
        </button>

        <!-- Chat Window -->
        <div id="chatWindow" style="display: none; position: absolute; bottom: 80px; right: 0; width: 380px; height: 550px; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); flex-direction: column; flex-display: none; overflow: hidden;">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); color: white; padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0; font-size: 1.1rem; font-weight: 700;">StayEase Assistant</h3>
                    <p style="margin: 0.3rem 0 0 0; font-size: 0.85rem; opacity: 0.9;">Hotel booking help</p>
                </div>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">‚úï</button>
            </div>

            <!-- Messages Container -->
            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; background: #f9fafb;">
                <div style="text-align: center; padding: 1rem; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üè®</div>
                    <p style="color: #6b7280; font-size: 0.9rem; margin: 0;">Hi! I'm your hotel booking assistant. Ask me about hotels, rooms, bookings, or policies!</p>
                </div>
            </div>

            <!-- Input Area -->
            <div style="border-top: 1px solid #e5e7eb; padding: 1rem; display: flex; gap: 0.5rem;">
                <input type="text" id="chatInput" placeholder="Ask about hotels..." style="flex: 1; padding: 0.8rem; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 0.9rem; outline: none;" onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()" style="background: #2563eb; color: white; border: none; padding: 0.8rem 1.2rem; border-radius: 10px; cursor: pointer; font-weight: 600;">Send</button>
            </div>
        </div>
    </div>

    <script>
        // Mock Data
        const hotels = [
            {
                id: 1,
                name: 'Pearl Continental Karachi',
                city: 'Karachi',
                address: 'Club Road, Karachi',
                rating: 4.7,
                description: 'Luxury 5-star hotel in the heart of Karachi with stunning city views',
                image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800&h=600&fit=crop',
                amenities: ['WiFi', 'Pool', 'Gym', 'Restaurant', 'Parking', 'Spa'],
                rooms: [
                    { type: 'Single', capacity: 1, price: 8000, available: 15, total: 20 },
                    { type: 'Double', capacity: 2, price: 12000, available: 20, total: 30 },
                    { type: 'Suite', capacity: 4, price: 25000, available: 5, total: 10 }
                ]
            },
            {
                id: 2,
                name: 'Avari Towers Karachi',
                city: 'Karachi',
                address: 'Fatima Jinnah Road, Karachi',
                rating: 4.5,
                description: 'Premium business hotel with modern amenities',
                image: 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?w=800&h=600&fit=crop',
                amenities: ['WiFi', 'Spa', 'Restaurant', 'Bar', '24/7 Service'],
                rooms: [
                    { type: 'Single', capacity: 1, price: 7000, available: 18, total: 25 },
                    { type: 'Double', capacity: 2, price: 11000, available: 25, total: 35 },
                    { type: 'Deluxe', capacity: 3, price: 18000, available: 10, total: 15 }
                ]
            },
            {
                id: 3,
                name: 'Marriott Hotel Lahore',
                city: 'Lahore',
                address: 'Shahrah-e-Quaid-e-Azam, Lahore',
                rating: 4.8,
                description: 'International luxury hotel with world-class facilities',
                image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=800&h=600&fit=crop',
                amenities: ['WiFi', 'Pool', 'Gym', 'Multiple Restaurants', 'Valet'],
                rooms: [
                    { type: 'Single', capacity: 1, price: 9000, available: 22, total: 30 },
                    { type: 'Double', capacity: 2, price: 14000, available: 30, total: 40 },
                    { type: 'Suite', capacity: 4, price: 30000, available: 8, total: 12 }
                ]
            }
        ];

        let currentUser = null;
        let searchParams = {};
        let currentHotel = null;
        let authToken = localStorage.getItem('authToken');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('checkInInput').min = today;
            document.getElementById('checkOutInput').min = today;
            
            // Restore user session from localStorage
            if (authToken) {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    updateAuthUI();
                    showPage('home');
                } else {
                    showPage('roleSelection');
                }
            } else {
                showPage('home');
                updateAuthUI();
            }
        });

        // Navigation
        function showPage(pageName) {
            ['homePage', 'resultsPage', 'detailsPage', 'loginPage', 'adminPage', 'bookingsPage', 'roleSelectionPage'].forEach(page => {
                const el = document.getElementById(page);
                if (el) el.classList.add('hidden');
            });
            const target = document.getElementById(pageName + 'Page');
            if (target) target.classList.remove('hidden');
            window.scrollTo(0, 0);

            // If navigating to bookings, load them
            if (pageName === 'bookings') {
                fetchUserBookings();
            }
            
            // If navigating to admin, load dashboard
            if (pageName === 'admin') {
                loadAdminDashboard();
            }
        }

        // Role selection
        let selectedRole = 'user';
        function selectRole(role) {
            selectedRole = role;
            showPage('login');
        }

        function goToLogin() {
            showPage('login');
        }

        // Update UI based on auth status
        function updateAuthUI() {
            const loggedIn = !!currentUser && !!authToken;
            const navbar = document.querySelector('.navbar');
            const navLinks = document.querySelector('.nav-links');
            
            if (loggedIn) {
                navLinks.innerHTML = `
                    <button onclick="showPage('bookings')" style="background: transparent; border: none; color: white; cursor: pointer; padding: 0.5rem 1rem; border-radius: 8px; transition: 0.3s;">My Bookings</button>
                    <span style="color: white; font-weight: 600;">${currentUser.name || currentUser.email}</span>
                    <button onclick="logout()" style="background: #ef4444; color: white; border: none; padding: 0.6rem 1.5rem; border-radius: 8px; cursor: pointer;">Logout</button>
                `;
            } else {
                navLinks.innerHTML = `<button onclick="showPage('roleSelection')" class="btn-primary">Sign In</button>`;
            }
        }

        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            updateAuthUI();
            showPage('home');
        }

        // Switch between login and signup tabs
        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const loginTabBtn = document.getElementById('loginTabBtn');
            const signupTabBtn = document.getElementById('signupTabBtn');

            if (tab === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                loginTabBtn.style.color = '#2563eb';
                loginTabBtn.style.borderBottomColor = '#2563eb';
                signupTabBtn.style.color = '#6b7280';
                signupTabBtn.style.borderBottomColor = 'transparent';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                signupTabBtn.style.color = '#2563eb';
                signupTabBtn.style.borderBottomColor = '#2563eb';
                loginTabBtn.style.color = '#6b7280';
                loginTabBtn.style.borderBottomColor = 'transparent';
            }
        }

        // Search Hotels (calls backend /api/hotels/search)
        async function searchHotels() {
            const city = document.getElementById('cityInput').value;
            const checkIn = document.getElementById('checkInInput').value;
            const checkOut = document.getElementById('checkOutInput').value;
            const guests = document.getElementById('guestsInput').value;

            if (!city || !checkIn || !checkOut) {
                alert('Please fill all search fields');
                return;
            }

            searchParams = { city, checkIn, checkOut, guests };

            try {
                const params = new URLSearchParams({ city, checkIn, checkOut, guests });
                const res = await fetch(`/api/hotels/search?${params.toString()}`);
                if (!res.ok) {
                    const err = await res.json();
                    alert(`Search failed: ${err.error || res.statusText}`);
                    return;
                }
                const data = await res.json();
                // backend returns { hotels, count }
                const results = data.hotels || [];
                // replace local hotels with results (so view/details use correct _id)
                window.hotels = results;
                displayResults(results);
                showPage('results');
            } catch (err) {
                alert(`Search error: ${err.message}`);
            }
        }

        // Display Results
        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            
            if (results.length === 0) {
                container.innerHTML = '<p style="text-align: center; font-size: 1.5rem; color: #6b7280;">No hotels found in this city</p>';
                return;
            }

            container.innerHTML = results.map(hotel => {
                const imageUrl = hotel.images && hotel.images.length > 0 ? hotel.images[0] : 'https://via.placeholder.com/300x200?text=Hotel';
                const minPrice = hotel.rooms && hotel.rooms.length > 0 
                    ? Math.min(...hotel.rooms.map(r => r.pricePerNight))
                    : 0;
                return `
                <div class="hotel-card">
                    <img src="${imageUrl}" alt="${hotel.name}" class="hotel-image" onerror="this.src='https://via.placeholder.com/300x200?text=Hotel'">
                    <div class="hotel-info">
                        <div class="hotel-header">
                            <div>
                                <h2 class="hotel-title">${hotel.name}</h2>
                                <p style="color: #f59e0b; font-weight: 600; margin: 0.5rem 0;">‚≠ê ${hotel.rating || 'N/A'}</p>
                                <p class="hotel-description">${hotel.description}</p>
                            </div>
                        </div>
                        <div class="amenities">
                            ${hotel.amenities.map(a => `<span class="amenity-tag">${a}</span>`).join('')}
                        </div>
                        <div class="hotel-footer">
                            <div class="price">
                                <span class="price-label">Starting from</span>
                                <div>
                                    <span class="price-amount">PKR ${minPrice.toLocaleString()}</span>
                                    <span style="color: #6b7280;"> / night</span>
                                </div>
                            </div>
                            <button class="btn-view" onclick="viewHotelDetails('${hotel._id || hotel.id}')">View Details</button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        // View Hotel Details
        function viewHotelDetails(hotelId) {
            // hotels array is populated from backend search; items use _id
            currentHotel = (window.hotels || []).find(h => (h._id === hotelId || h.id === hotelId));
            // if not found locally, fetch from backend
            if (!currentHotel) {
                // try fetching by id
                fetch(`/api/hotels/${hotelId}`)
                    .then(r => r.json())
                    .then(h => {
                        currentHotel = h;
                        renderHotelDetails();
                    })
                    .catch(() => alert('Unable to load hotel details'));
                return;
            }
            
            renderHotelDetails();
        }

        function renderHotelDetails() {
            const container = document.getElementById('detailsContainer');
            const imageUrl = currentHotel.images && currentHotel.images.length > 0 ? currentHotel.images[0] : 'https://via.placeholder.com/600x400?text=Hotel';
            container.innerHTML = `
                <div class="details-container">
                    <img src="${imageUrl}" alt="${currentHotel.name}" class="details-image" onerror="this.src='https://via.placeholder.com/600x400?text=Hotel'">
                    <div class="details-content">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem;">
                            <div>
                                <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem;">${currentHotel.name}</h1>
                                <p class="hotel-address" style="font-size: 1.1rem;">üìç ${currentHotel.address}</p>
                            </div>
                            <div class="rating" style="font-size: 1.3rem; padding: 0.8rem 1.5rem;">‚≠ê ${currentHotel.rating}</div>
                        </div>
                        
                        <p style="font-size: 1.1rem; color: #4b5563; line-height: 1.8; margin-bottom: 2rem;">${currentHotel.description}</p>
                        
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">Amenities</h3>
                        <div class="amenities" style="margin-bottom: 3rem;">
                            ${currentHotel.amenities.map(a => `<span class="amenity-tag" style="font-size: 1rem;">${a}</span>`).join('')}
                        </div>

                        <h3 style="font-size: 2rem; font-weight: 700; margin-bottom: 1.5rem;">Available Rooms</h3>
                        ${currentHotel.rooms.map(room => `
                            <div class="room-card">
                                <div class="room-header">
                                    <div style="flex: 1;">
                                        <h4 class="room-type">${room.roomType}</h4>
                                        <div class="room-details">
                                            <span>üë• Up to ${room.capacity} guests</span>
                                            <span class="availability">${room.totalRooms} rooms available</span>
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <p class="price-amount">PKR ${room.pricePerNight.toLocaleString()}</p>
                                        <p style="color: #6b7280; margin-bottom: 1.5rem;">per night</p>
                                        <button class="btn-book" onclick="bookRoom('${currentHotel._id || currentHotel.id}', '${room.roomType}', ${room.pricePerNight})" ${room.totalRooms === 0 ? 'disabled' : ''}>
                                            ${room.totalRooms > 0 ? 'Book Now' : 'Sold Out'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            showPage('details');
        }

        // Book Room
        async function bookRoom(hotelIdParam, roomType, price) {
            if (!currentUser) {
                alert('Please login to book');
                showPage('login');
                return;
            }

            // Prevent admins from creating bookings
            if (currentUser.role === 'admin') {
                alert('Admins cannot create bookings. Please use a regular user account to book.');
                return;
            }

            const checkIn = new Date(searchParams.checkIn);
            const checkOut = new Date(searchParams.checkOut);
            const nights = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));
            const total = price * nights;

            try {
                // Send booking to backend API with JWT token
                const response = await fetch('/api/bookings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        hotelId: hotelIdParam || (currentHotel && (currentHotel._id || currentHotel.id)),
                        roomType: roomType,
                        checkIn: searchParams.checkIn,
                        checkOut: searchParams.checkOut,
                        guests: searchParams.guests
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Booking failed: ${errorData.error || 'Unknown error'}`);
                    return;
                }

                const bookingData = await response.json();
                const bookedHotelName = bookingData.booking?.hotel?.name || (currentHotel && currentHotel.name) || '';
                alert(`Booking Confirmed! ‚úÖ\n\nHotel: ${bookedHotelName}\nRoom: ${roomType}\nNights: ${nights}\nTotal: PKR ${total.toLocaleString()}\n\nThank you for booking with StayEase!`);
                // After successful booking, refresh user's bookings if on bookings page
                if (!currentUser) return;
                if (document.getElementById('bookingsPage').classList.contains('hidden') === false) {
                    fetchUserBookings();
                }
            } catch (error) {
                alert(`Booking error: ${error.message}`);
            }
        }

        // Fetch and display current user's bookings
        // Admin Functions
        async function loadAdminDashboard() {
            if (!currentUser || currentUser.role !== 'admin') return;
            
            // Load analytics
            try {
                const res = await fetch('/api/bookings/admin/analytics', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('totalBookings').textContent = data.overview?.totalBookings || 0;
                    document.getElementById('totalRevenue').textContent = `PKR ${(data.overview?.totalRevenue || 0).toLocaleString()}`;
                }
            } catch (err) {
                console.log('Analytics error:', err.message);
            }

            // Load hotels
            await loadAdminHotels();
            
            // Load bookings
            await loadAdminBookings();
        }

        async function loadAdminHotels() {
            if (!authToken) return;
            try {
                const res = await fetch('/api/hotels/admin/all', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (res.ok) {
                    const hotels = await res.json();
                    document.getElementById('totalHotels').textContent = hotels.length;
                    
                    const tbody = document.getElementById('hotelsTableBody');
                    if (hotels.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4" style="padding: 1rem; text-align: center;">No hotels found.</td></tr>';
                    } else {
                        tbody.innerHTML = hotels.map(h => `
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 1rem;">${h.name}</td>
                                <td style="padding: 1rem;">${h.city}</td>
                                <td style="padding: 1rem;">${h.rating || 'N/A'}</td>
                                <td style="padding: 1rem; text-align: center;">
                                    <button onclick="deleteHotel('${h._id}')" style="background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Delete</button>
                                </td>
                            </tr>
                        `).join('');
                    }
                } else {
                    document.getElementById('hotelsTableBody').innerHTML = '<tr><td colspan="4" style="padding: 1rem; color: #f43f5e;">Error loading hotels</td></tr>';
                }
            } catch (err) {
                document.getElementById('hotelsTableBody').innerHTML = `<tr><td colspan="4" style="padding: 1rem; color: #f43f5e;">Error: ${err.message}</td></tr>`;
            }
        }

        async function loadAdminBookings() {
            if (!authToken) return;
            try {
                const res = await fetch('/api/bookings', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (res.ok) {
                    const bookings = await res.json();
                    const tbody = document.getElementById('bookingsTableBody');
                    if (bookings.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="padding: 1rem; text-align: center;">No bookings found.</td></tr>';
                    } else {
                        tbody.innerHTML = bookings.map(b => {
                            const checkIn = new Date(b.checkIn).toLocaleDateString();
                            const hotelName = b.hotel?.name || 'Unknown';
                            const guestName = b.user?.name || 'Unknown';
                            return `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 1rem;">${hotelName}</td>
                                    <td style="padding: 1rem;">${guestName}</td>
                                    <td style="padding: 1rem;">${checkIn}</td>
                                    <td style="padding: 1rem;"><strong>PKR ${Number(b.totalPrice).toLocaleString()}</strong></td>
                                    <td style="padding: 1rem;">${b.status}</td>
                                    <td style="padding: 1rem; text-align: center;">
                                        <select onchange="updateBookingStatus('${b._id}', this.value)" style="padding: 0.5rem; border-radius: 4px; border: 1px solid #d1d5db;">
                                            <option value="">Select...</option>
                                            <option value="confirmed">Confirmed</option>
                                            <option value="cancelled">Cancel</option>
                                        </select>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    }
                }
            } catch (err) {
                document.getElementById('bookingsTableBody').innerHTML = `<tr><td colspan="6" style="padding: 1rem; color: #f43f5e;">Error: ${err.message}</td></tr>`;
            }
        }

        function showAddHotelForm() {
            const form = document.getElementById('addHotelForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        async function handleAddHotel(event) {
            event.preventDefault();
            if (!authToken) return;

            const hotel = {
                name: document.getElementById('hotelName').value,
                city: document.getElementById('hotelCity').value,
                address: document.getElementById('hotelAddress').value,
                description: document.getElementById('hotelDescription').value,
                rating: parseFloat(document.getElementById('hotelRating').value),
                images: ['https://via.placeholder.com/300x200?text=Hotel'],
                amenities: ['WiFi', 'Pool', 'Gym', 'Restaurant'],
                rooms: [
                    { roomType: 'Single', capacity: 1, pricePerNight: 5000, totalRooms: 10, amenities: ['WiFi', 'AC'] },
                    { roomType: 'Double', capacity: 2, pricePerNight: 8000, totalRooms: 20, amenities: ['WiFi', 'AC', 'TV'] }
                ]
            };

            try {
                const res = await fetch('/api/hotels', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(hotel)
                });

                if (res.ok) {
                    alert('Hotel added successfully!');
                    document.getElementById('addHotelForm').style.display = 'none';
                    document.getElementById('hotelName').value = '';
                    document.getElementById('hotelCity').value = '';
                    document.getElementById('hotelAddress').value = '';
                    document.getElementById('hotelDescription').value = '';
                    document.getElementById('hotelRating').value = '';
                    loadAdminHotels();
                } else {
                    const err = await res.json();
                    alert(`Error: ${err.error}`);
                }
            } catch (err) {
                alert(`Error: ${err.message}`);
            }
        }

        async function deleteHotel(hotelId) {
            if (!confirm('Are you sure you want to delete this hotel?')) return;
            if (!authToken) return;

            try {
                const res = await fetch(`/api/hotels/${hotelId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (res.ok) {
                    alert('Hotel deleted successfully!');
                    loadAdminHotels();
                } else {
                    const err = await res.json();
                    alert(`Error: ${err.error}`);
                }
            } catch (err) {
                alert(`Error: ${err.message}`);
            }
        }

        async function updateBookingStatus(bookingId, status) {
            if (!status) return;
            if (!authToken) return;

            try {
                const res = await fetch(`/api/bookings/${bookingId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ status })
                });

                if (res.ok) {
                    alert('Booking updated successfully!');
                    loadAdminBookings();
                } else {
                    const err = await res.json();
                    alert(`Error: ${err.error}`);
                }
            } catch (err) {
                alert(`Error: ${err.message}`);
            }
        }

        async function fetchUserBookings() {
            if (!currentUser || !authToken) return;
            try {
                const res = await fetch(`/api/bookings/user/${currentUser.id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (!res.ok) {
                    const err = await res.json();
                    document.getElementById('bookingsContainer').innerHTML = `<p style="color:#f43f5e">Error: ${err.error || 'Unable to load bookings'}</p>`;
                    return;
                }
                const bookings = await res.json();
                displayBookings(bookings);
            } catch (err) {
                document.getElementById('bookingsContainer').innerHTML = `<p style="color:#f43f5e">Error: ${err.message}</p>`;
            }
        }

        function displayBookings(bookings) {
            if (!bookings || bookings.length === 0) {
                document.getElementById('bookingsContainer').innerHTML = '<p>No bookings found.</p>';
                return;
            }

            const html = bookings.map(b => {
                const hotelName = b.hotel?.name || 'Unknown Hotel';
                const checkIn = new Date(b.checkIn).toLocaleDateString();
                const checkOut = new Date(b.checkOut).toLocaleDateString();
                return `
                    <div class="room-card" style="margin-bottom:1rem;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div>
                                <div style="font-weight:700">${hotelName}</div>
                                <div style="color:#6b7280">${b.roomType} ‚Ä¢ ${b.guests} guests</div>
                                <div style="margin-top:0.5rem">${checkIn} ‚Üí ${checkOut}</div>
                            </div>
                            <div style="text-align:right">
                                <div style="font-weight:700;color:#2563eb">PKR ${Number(b.totalPrice).toLocaleString()}</div>
                                <div style="color:#6b7280">${b.status}</div>
                                <button class="btn-book" style="margin-top:0.5rem;" onclick='showReceipt(${JSON.stringify(JSON.stringify(b))})'>View Receipt</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('bookingsContainer').innerHTML = html;
        }

        // Show receipt in a simple popup
        function showReceipt(bookingJson) {
            const b = JSON.parse(bookingJson);
            const hotelName = b.hotel?.name || 'Unknown Hotel';
            const checkIn = new Date(b.checkIn).toLocaleString();
            const checkOut = new Date(b.checkOut).toLocaleString();
            const receipt = `Receipt\n\nHotel: ${hotelName}\nRoom: ${b.roomType}\nGuests: ${b.guests}\nCheck-in: ${checkIn}\nCheck-out: ${checkOut}\nTotal: PKR ${Number(b.totalPrice).toLocaleString()}\nStatus: ${b.status}`;
            alert(receipt);
        }

        // Login
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            
            try {
                // Call backend login API
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Login failed: ${errorData.error || 'Invalid credentials'}`);
                    return;
                }

                const data = await response.json();
                
                // Check if role matches selection
                if (selectedRole === 'admin' && data.user.role !== 'admin') {
                    alert('This account does not have admin privileges. Please use an admin account.');
                    return;
                }
                
                if (selectedRole === 'user' && data.user.role === 'admin') {
                    alert('Please use the Admin Panel to login with an admin account.');
                    return;
                }
                
                // Store JWT token and user info
                authToken = data.token;
                localStorage.setItem('authToken', authToken);
                
                currentUser = {
                    id: data.user._id,
                    name: data.user.name,
                    email: data.user.email,
                    role: data.user.role
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                // Clear form
                document.getElementById('emailInput').value = '';
                document.getElementById('passwordInput').value = '';

                updateAuthUI();
                
                if (currentUser.role === 'admin') {
                    showPage('admin');
                } else {
                    showPage('home');
                }
            } catch (error) {
                alert(`Login error: ${error.message}`);
            }
        }

        // Signup
        async function handleSignup(event) {
            event.preventDefault();
            
            const name = document.getElementById('nameInput').value;
            const email = document.getElementById('signupEmailInput').value;
            const password = document.getElementById('signupPasswordInput').value;
            
            try {
                // Call backend register API
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Signup failed: ${errorData.error || 'Unknown error'}`);
                    return;
                }

                alert('Account created successfully! Please log in.');
                
                // Clear signup form and switch to login tab
                document.getElementById('nameInput').value = '';
                document.getElementById('signupEmailInput').value = '';
                document.getElementById('signupPasswordInput').value = '';
                
                switchAuthTab('login');
                
                // Pre-fill email in login form
                document.getElementById('emailInput').value = email;
            } catch (error) {
                alert(`Signup error: ${error.message}`);
            }
        }

        // Logout
        function logout() {
            currentUser = null;
            authToken = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            updateAuthUI();
            showPage('home');
        }

        // Update Auth UI
        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('userGreeting').classList.remove('hidden');
                document.getElementById('userGreeting').textContent = `Hi, ${currentUser.name} (${currentUser.role})`;
                
                // show bookings for all logged-in users
                document.getElementById('bookingsNavBtn').classList.remove('hidden');

                if (currentUser.role === 'admin') {
                    document.getElementById('adminNavBtn').classList.remove('hidden');
                } else {
                    document.getElementById('adminNavBtn').classList.add('hidden');
                }
            } else {
                document.getElementById('loginBtn').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.add('hidden');
                document.getElementById('userGreeting').classList.add('hidden');
                document.getElementById('adminNavBtn').classList.add('hidden');
                document.getElementById('bookingsNavBtn').classList.add('hidden');
            }
        }

        // AI Chat Widget Functions
        let chatContext = { lastQuery: '', conversationCount: 0 };
        
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            const chatToggle = document.getElementById('chatToggle');
            if (chatWindow.style.display === 'none') {
                chatWindow.style.display = 'flex';
                chatToggle.style.transform = 'scale(0.9)';
                document.getElementById('chatInput').focus();
            } else {
                chatWindow.style.display = 'none';
                chatToggle.style.transform = 'scale(1)';
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addChatMessage(message, 'user');
            input.value = '';

            // Simulate AI response with delay
            setTimeout(() => {
                const response = getAIResponse(message);
                addChatMessage(response, 'ai');
            }, 500);
        }

        function addChatMessage(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                padding: 1rem;
                border-radius: 12px;
                max-width: 90%;
                word-wrap: break-word;
                line-height: 1.5;
                white-space: pre-wrap;
                ${sender === 'user' 
                    ? 'background: #2563eb; color: white; margin-left: auto; text-align: right;' 
                    : 'background: white; color: #333; box-shadow: 0 2px 8px rgba(0,0,0,0.05);'}
            `;
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getAIResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            chatContext.conversationCount++;
            chatContext.lastQuery = msg;

            // Greetings
            if (msg.match(/^(hi|hello|hey|greetings|good morning|good afternoon|good evening)\b/)) {
                const greeting = currentUser 
                    ? `üëã Welcome back, ${currentUser.name}! How can I help you today?`
                    : 'üëã Hello! I\'m your StayEase AI assistant. Need help booking a hotel?';
                return greeting;
            }

            // Quick questions
            if (msg === 'thanks' || msg === 'thank you' || msg === 'ty') {
                return 'üòä You\'re welcome! Is there anything else I can help you with?';
            }

            if (msg === 'yes' || msg === 'yeah' || msg === 'yep') {
                return 'üí° What would you like to know? Feel free to ask about hotels, bookings, or anything else!';
            }

            if (msg === 'no' || msg === 'nope' || msg === 'nah') {
                return 'üëç No problem! Let me know when you need help. I\'m here 24/7!';
            }

            // Check for availability-related questions with room type and date
            const roomTypeMatch = msg.match(/\b(single|double|deluxe|suite)\b/i);
            const datePatterns = [
                /(\d{1,2})\s+(jan|january|feb|february|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|september|oct|october|nov|november|dec|december)\b/i,
                /(\d{1,2})[-\/](\d{1,2})[-\/](\d{2,4})/i,
                /(jan|january|feb|february|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|september|oct|october|nov|november|dec|december)\s+(\d{1,2})\b/i
            ];
            
            let dateMatch = null;
            for (const pattern of datePatterns) {
                dateMatch = msg.match(pattern);
                if (dateMatch) break;
            }

            // If we found room type and date, query availability
            if (roomTypeMatch && dateMatch && (msg.includes('available') || msg.includes('room') || msg.includes('booking'))) {
                const roomType = roomTypeMatch[1].charAt(0).toUpperCase() + roomTypeMatch[1].slice(1);
                const dateStr = extractDateString(userMessage, dateMatch);
                
                // Return a loading message first, then fetch
                fetchAndFormatAvailability(roomType, dateStr);
                return 'üîç Checking availability for ' + roomType + ' rooms on ' + dateStr + '...';
            }

            // Hotel search & availability
            if (msg.includes('search') || msg.includes('find') || msg.includes('available')) {
                return 'üè® I can help you find available hotels! Here are some ways to search:\n‚Ä¢ "Show me Deluxe rooms in Karachi on 15 Dec"\n‚Ä¢ "Are there any Suite rooms available?"\n‚Ä¢ "What 5-star hotels have pools?"\n\nOr use the search bar above to filter by city, dates, and guest count!';
            }

            // Rooms & pricing
            if (msg.includes('room') || msg.includes('price') || msg.includes('cost')) {
                return 'üí∞ **Our Room Types:**\n‚Ä¢ **Single** - Perfect for solo travelers (‚Ç®8,000-10,000/night)\n‚Ä¢ **Double** - Ideal for couples (‚Ç®12,000-15,000/night)\n‚Ä¢ **Deluxe** - Spacious & luxurious (‚Ç®18,000-25,000/night)\n‚Ä¢ **Suite** - Premium with living area (‚Ç®25,000-35,000/night)\n\nPrices vary by hotel and season. Tell me your budget!';
            }

            // Booking process
            if (msg.includes('book') || msg.includes('reserve') || msg.includes('booking')) {
                return 'üìÖ **How to Book:**\n1Ô∏è‚É£ Search for hotels (use the search bar)\n2Ô∏è‚É£ Click "View Details" on a hotel\n3Ô∏è‚É£ Select your desired room type\n4Ô∏è‚É£ Click "Book Now"\n5Ô∏è‚É£ Confirm dates & guests\n6Ô∏è‚É£ Complete payment\n\n‚ö†Ô∏è You must be logged in to book!';
            }

            // Cancellation & policies
            if (msg.includes('cancel') || msg.includes('refund') || msg.includes('policy')) {
                return 'üîÑ **Cancellation Policy:**\n‚úÖ Free cancellation up to 48 hours before check-in\n‚ö†Ô∏è Cancellations within 48 hours may incur charges\nüí° Each hotel has its own policy - always check before booking\n\nNeed to cancel a booking? Go to "My Bookings" and select the reservation.';
            }

            // Login/account
            if (msg.includes('login') || msg.includes('account') || msg.includes('sign') || msg.includes('register')) {
                return 'üîê **Getting Started:**\n‚Ä¢ Click "Sign In" button in top-right\n‚Ä¢ Choose: **User** (book hotels) or **Admin** (manage system)\n‚Ä¢ First time? Click "Sign Up" to create account\n‚Ä¢ Demo credentials:\n  üìß ahmed@example.com / user123\n  üîë admin@hotel.com / admin123';
            }

            // Amenities
            if (msg.includes('amenity') || msg.includes('amenities') || msg.includes('wifi') || msg.includes('pool') || msg.includes('gym') || msg.includes('spa') || msg.includes('parking')) {
                return '‚ú® **Popular Amenities:**\nüõ°Ô∏è WiFi - High-speed internet\nüèä Pool - Relax & swim\nüí™ Gym - Full fitness center\nüçΩÔ∏è Restaurant - On-site dining\nüßñ Spa - Massage & wellness\nüöó Valet Parking - Free parking\nüè® Concierge - 24/7 assistance\n\nEach hotel details page shows available amenities!';
            }

            // Payment & checkout
            if (msg.includes('pay') || msg.includes('payment') || msg.includes('check') || msg.includes('checkout')) {
                return 'üí≥ **Payment Details:**\n‚úÖ Secure payment processing\nüìÖ Prices based on:\n  ‚Ä¢ Room type\n  ‚Ä¢ Number of nights\n  ‚Ä¢ Hotel location\n  ‚Ä¢ Current demand\n\nüí∞ Total = Price/night √ó Number of nights\n\nWe accept all major payment methods!';
            }

            // Cities
            if (msg.includes('city') || msg.includes('location') || msg.includes('where')) {
                return 'üìç **Available Cities:**\nüáµüá∞ Pakistan:\n  ‚Ä¢ Karachi - Coastal city\n  ‚Ä¢ Lahore - Cultural hub\n  ‚Ä¢ Islamabad - Capital city\n\nüåç International:\n  ‚Ä¢ Dubai - Luxury destination\n  ‚Ä¢ Istanbul - Historic city\n  ‚Ä¢ London - Iconic capital\n\nSearch your preferred city!';
            }

            // Rating & reviews
            if (msg.includes('rating') || msg.includes('review') || msg.includes('star') || msg.includes('quality')) {
                return '‚≠ê **Hotel Ratings:**\n5‚≠ê - Exceptional (4.5+) - Luxury experience\n4‚≠ê - Excellent (4.0-4.5) - Great quality\n3‚≠ê - Good (3.5-4.0) - Solid value\n2‚≠ê - Fair (3.0-3.5) - Budget option\n\nRatings come from verified guest reviews. Filter by rating in search!';
            }

            // Help & support
            if (msg.includes('help') || msg.includes('support') || msg.includes('problem') || msg.includes('issue') || msg.includes('error')) {
                return 'üÜò **Need Help?**\n\n‚ùì Common Issues:\n‚Ä¢ Can\'t login? Check your email & password\n‚Ä¢ No availability? Try different dates\n‚Ä¢ Payment failed? Try another card\n\nüìû Contact Support:\nüìß Email: support@stayease.com\nüïê Available 24/7\n\nI can also answer specific questions!';
            }

            // Default response
            return 'üëã **Welcome to StayEase AI Assistant!**\n\nI can help you with:\nüîç Searching hotels\nüí∞ Pricing & room types\nüìÖ Booking process\nüè® Amenities & facilities\nüîê Account & login\nüîÑ Cancellations\nüìç Locations\n‚≠ê Ratings\nüÜò Support\n\nWhat would you like to know?';
        }

        function extractDateString(userMessage, dateMatch) {
            // Parse matched date and convert to YYYY-MM-DD format
            const msg = userMessage.toLowerCase();
            
            // Handle "15 Dec" or "Dec 15" format
            const dayMonthMatch = msg.match(/(\d{1,2})\s+(jan|january|feb|february|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|september|oct|october|nov|november|dec|december)\b/i);
            if (dayMonthMatch) {
                const day = dayMonthMatch[1].padStart(2, '0');
                const monthStr = dayMonthMatch[2].substring(0, 3).toLowerCase();
                const months = { 'jan': '01', 'feb': '02', 'mar': '03', 'apr': '04', 'may': '05', 'jun': '06', 'jul': '07', 'aug': '08', 'sep': '09', 'oct': '10', 'nov': '11', 'dec': '12' };
                const month = months[monthStr];
                const year = new Date().getFullYear();
                return day + '-' + month + '-' + year;
            }

            const monthDayMatch = msg.match(/(jan|january|feb|february|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|september|oct|october|nov|november|dec|december)\s+(\d{1,2})\b/i);
            if (monthDayMatch) {
                const monthStr = monthDayMatch[1].substring(0, 3).toLowerCase();
                const day = monthDayMatch[2].padStart(2, '0');
                const months = { 'jan': '01', 'feb': '02', 'mar': '03', 'apr': '04', 'may': '05', 'jun': '06', 'jul': '07', 'aug': '08', 'sep': '09', 'oct': '10', 'nov': '11', 'dec': '12' };
                const month = months[monthStr];
                const year = new Date().getFullYear();
                return day + '-' + month + '-' + year;
            }

            // Default fallback
            return new Date().toISOString().split('T')[0];
        }

        function formatDateForAPI(dateStr) {
            // Convert DD-MM-YYYY to YYYY-MM-DD
            const parts = dateStr.split('-');
            if (parts.length === 3) {
                return parts[2] + '-' + parts[1] + '-' + parts[0];
            }
            return dateStr;
        }

        async function fetchAndFormatAvailability(roomType, dateStr) {
            try {
                const apiDate = formatDateForAPI(dateStr);
                const response = await fetch(`/api/hotels/availability/check?roomType=${encodeURIComponent(roomType)}&date=${apiDate}`);
                const data = await response.json();

                let result = '';
                if (data.available && data.hotels && data.hotels.length > 0) {
                    result = `‚úÖ Great news! Found ${data.availableCount} hotel(s) with ${roomType} rooms available on ${dateStr}:\n\n`;
                    data.hotels.forEach(hotel => {
                        const price = hotel.pricePerNight ? hotel.pricePerNight.toLocaleString() : 'N/A';
                        result += `üè® ${hotel.hotelName} (${hotel.hotelCity})\n   ‚Ä¢ Available Rooms: ${hotel.availableRooms}/${hotel.totalRooms}\n   ‚Ä¢ Price: PKR ${price}/night\n\n`;
                    });
                    result += 'Would you like to book any of these hotels? Just search on the home page to complete your reservation!';
                } else {
                    result = `üòî Sorry, no ${roomType} rooms available on ${dateStr}. Try another date or room type!`;
                }

                // Add the formatted result to chat
                addChatMessage(result, 'ai');
            } catch (error) {
                console.error('Error fetching availability:', error);
                addChatMessage('‚ö†Ô∏è I encountered an error checking availability. Please try searching on the home page instead.', 'ai');
            }
        }
    </script>

</body>
</html>
                            <div class="rating">‚≠ê ${hotel.rating}</div>
